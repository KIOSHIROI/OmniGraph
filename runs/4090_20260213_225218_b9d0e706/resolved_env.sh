#!/usr/bin/env bash
set -euo pipefail

export AUTO_BATCH_BY_VRAM=1
export AUTO_BATCH_MAX_RETRIES=8
export AUTO_BATCH_RETRY_ON_OOM=1
export AUTO_BATCH_SCALE=1.0
export COVERAGE_TARGET=0.9990
export ENABLE_GRAPH_AUX_HEAD=1
export ENABLE_GVL_ADAPTER=1
export ENABLE_XTC=1
export ENABLE_XTM=1
export GPU=0
export GQA_EVAL_PAPER='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/eval/eval_val_balanced_paper.txt'
export GQA_EVAL_R2='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/eval/eval_val_balanced_round2.txt'
export GQA_PRED_PAPER='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/eval/pred_val_balanced_paper.jsonl'
export GQA_PRED_R2='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/eval/pred_val_balanced_round2.jsonl'
export GRAPH_BOOTSTRAP_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_bootstrap'
export GRAPH_REFINE_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_refine'
export GRAPH_REFINE_R2_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_refine_round2'
export GRAPH_TOKENIZER_TYPE=perceiver
export ISOLATE_GPU=1
export LLM_ATTN_IMPL=sdpa
export LLM_DTYPE=bfloat16
export LLM_MODEL=Qwen/Qwen2.5-3B-Instruct
export LOW_VRAM_4090=0
export MULTIMODAL_TUNE_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/multimodal_tune'
export MULTIMODAL_TUNE_R2_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/multimodal_tune_round2'
export NODE_ENCODER_ALPHA_INIT=0.3
export NODE_ENCODER_OUT_DIM=128
export NODE_ENCODER_TYPE=hybrid
export OMNIGRAPH_HF_CACHE=/media/disk/02drive/13hias/.cache
export OMNIGRAPH_HF_ENDPOINT=https://hf-mirror.com
export PERCEIVER_DROPOUT=0.0
export PERCEIVER_FF_MULT=4
export PERCEIVER_NUM_HEADS=8
export PERCEIVER_NUM_LATENTS=32
export PERCEIVER_NUM_LAYERS=3
export PIPELINE_MODE=full
export QUERY_SPRINT_TARGET=0.2800
export QUERY_TARGET=0.2600
export REPO='/Users/kioshiro/程序/OmniGraph'
export RUN_ID=4090_20260213_225218_b9d0e706
export RUN_ROUND2_ON_FAIL=1
export STAGE1_BATCH_SIZE=16
export STAGE1_DATASET_PATHS='data/train_instruct_graphmatch.json data/arxiv_pub_node_st_cot_link_mix.json'
export STAGE1_EARLY_STOP_MIN_DELTA=0.001
export STAGE1_EARLY_STOP_MODE=min
export STAGE1_EARLY_STOP_PATIENCE=2
export STAGE1_ENABLE_EARLY_STOP=1
export STAGE1_EPOCHS=20
export STAGE1_EXPORT_PATH='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_qformer_stage1.pt'
export STAGE1_GTC_LOSS_WEIGHT=1.0
export STAGE1_GTM_LABEL_SMOOTHING=0.0
export STAGE1_GTM_LOSS_WEIGHT=1.2
export STAGE1_GTM_MAX_LEN=512
export STAGE1_GTM_NEG_PER_POS=2
export STAGE1_GTM_TEXT_DUP_THRESH=0.98
export STAGE1_GTM_TEXT_SOURCE=qa
export STAGE1_GTM_USE_HARD_NEG=1
export STAGE1_GTM_WARMUP_STEPS=1000
export STAGE1_LR=1e-4
export STAGE1_MAX_STEPS=-1
export STAGE1_TEXT_MAX_LEN=512
export STAGE1_TEXT_MODEL_NAME=sentence-transformers/all-mpnet-base-v2
export STAGE2A_BOOTSTRAP_MODE=no_stage1
export STAGE2A_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_bootstrap'
export STAGE2B_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_refine'
export STAGE2B_R2_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/graph_refine_round2'
export STAGE3_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/multimodal_tune'
export STAGE3_R2_DIR='/Users/kioshiro/程序/OmniGraph/runs/4090_20260213_225218_b9d0e706/checkpoints/multimodal_tune_round2'
export STRICT_SPRINT_TARGET=0.4400
export STRICT_TARGET=0.4200
export TOKENIZERS_PARALLELISM=false
export USE_QA_TYPE_TOKEN=1
export VISION_MODEL=Salesforce/blip2-flan-t5-xl
